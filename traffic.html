<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swiss Highway Traffic - OpenSwiss.info</title>
    <meta name="description" content="Real-time traffic flow visualization on Swiss highways">
    <link rel="stylesheet" href="styles.css">

    <!-- D3.js for data visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <div class="logo">open <span class="swiss">swiss</span> info</div>
                <div class="language-bar">
                    <div class="language-links">
                        <a href="#de">DE</a>
                        <span>|</span>
                        <a href="#fr">FR</a>
                        <span>|</span>
                        <a href="#it">IT</a>
                        <span>|</span>
                        <a href="#en" class="active">EN</a>
                    </div>
                </div>
            </div>
            <nav class="nav">
                <div class="nav-item">
                    <a href="index.html">home</a>
                </div>
                <div class="nav-item">
                    <a href="#about">about</a>
                </div>
                <div class="nav-item">
                    <a href="#data">data</a>
                    <div class="dropdown">
                        <a href="#demographics">demographics</a>
                        <a href="#politics">politics</a>
                        <a href="#culture">culture</a>
                        <a href="#economy">economy</a>
                        <a href="#geography">geography</a>
                        <a href="#education">education</a>
                        <a href="#healthcare">healthcare</a>
                        <a href="#environment">environment</a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="visualizations.html" class="active">visualizations</a>
                    <div class="dropdown">
                        <a href="visualizations.html">rail</a>
                        <a href="traffic.html">road</a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="#contact">contact</a>
                </div>
            </nav>
        </header>

        <div class="graph-panel">
            <h2 class="panel-title">Traffic Flow</h2>
            <div class="data-controls">
                <div class="control-group">
                    <label class="control-label">Highway</label>
                    <select id="highway-selector" class="control-input">
                        <option value="all">All Highways</option>
                        <option value="A1">A1 (Geneva-St. Gallen)</option>
                        <option value="A2">A2 (Basel-Chiasso)</option>
                        <option value="A3">A3 (Basel-Sargans)</option>
                        <option value="A4">A4 (Schaffhausen-Altdorf)</option>
                    </select>
                </div>
            </div>

            <h2 class="panel-title" style="margin-top: 24px;">Legend</h2>
            <div style="font-size: 12px; line-height: 1.8; color: #333;">
                <div style="display: flex; align-items: center; margin-bottom: 6px;">
                    <div style="width: 20px; height: 3px; background: #22c55e; margin-right: 8px;"></div>
                    <span>Free flow (&lt;1000 veh/h)</span>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 6px;">
                    <div style="width: 20px; height: 3px; background: #eab308; margin-right: 8px;"></div>
                    <span>Moderate (1000-2000 veh/h)</span>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 6px;">
                    <div style="width: 20px; height: 3px; background: #f97316; margin-right: 8px;"></div>
                    <span>Heavy (2000-3000 veh/h)</span>
                </div>
                <div style="display: flex; align-items: center;">
                    <div style="width: 20px; height: 3px; background: #dc2626; margin-right: 8px;"></div>
                    <span>Congested (&gt;3000 veh/h)</span>
                </div>
            </div>

            <h2 class="panel-title" style="margin-top: 24px;">Info</h2>
            <div style="font-size: 12px; line-height: 1.6; color: #333;">
                <p style="margin-bottom: 8px;">500+ counting stations monitor traffic on Swiss highways 24/7</p>
                <p style="margin-bottom: 8px;">Data updates every minute</p>
                <p>Click on highways for detailed flow information</p>
            </div>
        </div>

        <div class="chat-panel">
            <div class="chat-header">
                <h1 class="chat-title">Swiss Highway Traffic Flow</h1>
                <p class="chat-subtitle">Real-time visualization of traffic density on major Swiss motorways</p>
            </div>

            <div id="traffic-map" style="height: 600px; position: relative;">
                <svg id="highway-svg" style="width: 100%; height: 100%; background: #fafafa; border: 1px solid #e0e0e0;"></svg>
                <div id="loading-traffic" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #666; background: rgba(255,255,255,0.95); padding: 30px; border-radius: 8px;">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">Loading highway network...</div>
                    <div style="font-size: 12px; color: #999;">Connecting to traffic data</div>
                </div>
            </div>
        </div>

        <div class="citations-panel">
            <h2 class="panel-title">Traffic Details</h2>
            <div id="traffic-info" style="background: #f5f5f5; border: 1px solid #e0e0e0; border-radius: 4px; padding: 16px; min-height: 200px; font-size: 13px; color: #666; margin-bottom: 24px;">
                Click on a highway segment to view traffic flow details
            </div>

            <h2 class="panel-title">Data Sources</h2>
            <div class="citations-list">
                <div class="citation">
                    <div class="citation-number">[1]</div>
                    <div class="citation-title"><a href="https://opentransportdata.swiss/en/dataset/trafficcountersrealtime" target="_blank">Real-Time Traffic Counters</a></div>
                    <div class="citation-source">opentransportdata.swiss</div>
                    <div class="citation-excerpt">Live traffic flow data from 500+ counting stations on Swiss motorways, updated every minute.</div>
                </div>

                <div class="citation">
                    <div class="citation-number">[2]</div>
                    <div class="citation-title"><a href="https://www.astra.admin.ch/astra/en/home/documentation/data-and-information-products/traffic-data.html" target="_blank">FEDRO Traffic Data</a></div>
                    <div class="citation-source">Federal Roads Office</div>
                    <div class="citation-excerpt">Swiss automatic road traffic counts (SARTC) operated by FEDRO since 1961.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Swiss Highway Traffic Visualization
        // Major highways with geographic routing
        const highways = [
            {
                id: 'A1',
                name: 'A1 (Geneva-St. Gallen)',
                color: '#3b82f6',
                segments: [
                    { from: 'Geneva', to: 'Lausanne', x1: 120, y1: 380, x2: 200, y2: 400, flow: 2800 },
                    { from: 'Lausanne', to: 'Yverdon', x1: 200, y1: 400, x2: 260, y2: 360, flow: 2200 },
                    { from: 'Yverdon', to: 'Bern', x1: 260, y1: 360, x2: 400, y2: 280, flow: 3200 },
                    { from: 'Bern', to: 'Solothurn', x1: 400, y1: 280, x2: 380, y2: 220, flow: 2400 },
                    { from: 'Solothurn', to: 'Aarau', x1: 380, y1: 220, x2: 480, y2: 200, flow: 2900 },
                    { from: 'Aarau', to: 'Zürich', x1: 480, y1: 200, x2: 650, y2: 200, flow: 3800 },
                    { from: 'Zürich', to: 'Winterthur', x1: 650, y1: 200, x2: 720, y2: 180, flow: 2600 },
                    { from: 'Winterthur', to: 'St. Gallen', x1: 720, y1: 180, x2: 850, y2: 160, flow: 1800 }
                ]
            },
            {
                id: 'A2',
                name: 'A2 (Basel-Chiasso)',
                color: '#10b981',
                segments: [
                    { from: 'Basel', to: 'Liestal', x1: 280, y1: 150, x2: 340, y2: 180, flow: 2100 },
                    { from: 'Liestal', to: 'Luzern', x1: 340, y1: 180, x2: 520, y2: 320, flow: 2700 },
                    { from: 'Luzern', to: 'Altdorf', x1: 520, y1: 320, x2: 580, y2: 420, flow: 1900 },
                    { from: 'Altdorf', to: 'Bellinzona', x1: 580, y1: 420, x2: 700, y2: 550, flow: 1600 },
                    { from: 'Bellinzona', to: 'Lugano', x1: 700, y1: 550, x2: 680, y2: 600, flow: 1400 }
                ]
            },
            {
                id: 'A3',
                name: 'A3 (Basel-Sargans)',
                color: '#8b5cf6',
                segments: [
                    { from: 'Basel', to: 'Zürich', x1: 280, y1: 150, x2: 650, y2: 200, flow: 3100 },
                    { from: 'Zürich', to: 'Rapperswil', x1: 650, y1: 200, x2: 750, y2: 240, flow: 2300 },
                    { from: 'Rapperswil', to: 'Sargans', x1: 750, y1: 240, x2: 820, y2: 320, flow: 1500 }
                ]
            },
            {
                id: 'A4',
                name: 'A4 (Schaffhausen-Altdorf)',
                color: '#f59e0b',
                segments: [
                    { from: 'Schaffhausen', to: 'Winterthur', x1: 680, y1: 100, x2: 720, y2: 180, flow: 1200 },
                    { from: 'Winterthur', to: 'Zürich', x1: 720, y1: 180, x2: 650, y2: 200, flow: 2500 },
                    { from: 'Zürich', to: 'Zug', x1: 650, y1: 200, x2: 600, y2: 280, flow: 2800 },
                    { from: 'Zug', to: 'Altdorf', x1: 600, y1: 280, x2: 580, y2: 420, flow: 1700 }
                ]
            }
        ];

        // Setup SVG
        const container = document.getElementById('traffic-map');
        const svg = d3.select('#highway-svg');
        const width = container.offsetWidth || 700;
        const height = 600;

        svg.attr('width', width).attr('height', height);

        // Color scale for traffic flow
        function getFlowColor(flow) {
            if (flow < 1000) return '#22c55e'; // Green - free flow
            if (flow < 2000) return '#eab308'; // Yellow - moderate
            if (flow < 3000) return '#f97316'; // Orange - heavy
            return '#dc2626'; // Red - congested
        }

        // Function to get stroke width based on flow
        function getFlowWidth(flow) {
            return Math.min(3 + (flow / 500), 12);
        }

        // Scale positions to fit SVG
        const scale = Math.min(width / 1000, 1);

        // Draw all highway segments
        const segmentGroup = svg.append('g');

        highways.forEach(highway => {
            highway.segments.forEach((segment, idx) => {
                const line = segmentGroup.append('line')
                    .attr('x1', segment.x1 * scale)
                    .attr('y1', segment.y1)
                    .attr('x2', segment.x2 * scale)
                    .attr('y2', segment.y2)
                    .attr('stroke', getFlowColor(segment.flow))
                    .attr('stroke-width', getFlowWidth(segment.flow))
                    .attr('stroke-linecap', 'round')
                    .attr('opacity', 0.8)
                    .attr('class', `highway-${highway.id}`)
                    .style('cursor', 'pointer')
                    .on('click', () => showTrafficInfo(highway, segment))
                    .on('mouseover', function() {
                        d3.select(this).attr('opacity', 1).attr('stroke-width', getFlowWidth(segment.flow) + 2);
                    })
                    .on('mouseout', function() {
                        d3.select(this).attr('opacity', 0.8).attr('stroke-width', getFlowWidth(segment.flow));
                    });

                // Add highway label on first segment
                if (idx === 0) {
                    segmentGroup.append('text')
                        .attr('x', segment.x1 * scale)
                        .attr('y', segment.y1 - 10)
                        .attr('font-size', '12px')
                        .attr('font-weight', '700')
                        .attr('fill', highway.color)
                        .text(highway.id)
                        .style('pointer-events', 'none');
                }
            });
        });

        // Add city markers
        const cities = [
            { name: 'Geneva', x: 120, y: 380 },
            { name: 'Basel', x: 280, y: 150 },
            { name: 'Zürich', x: 650, y: 200 },
            { name: 'Bern', x: 400, y: 280 },
            { name: 'Luzern', x: 520, y: 320 },
            { name: 'St. Gallen', x: 850, y: 160 },
            { name: 'Lugano', x: 680, y: 600 }
        ];

        cities.forEach(city => {
            // City marker
            svg.append('circle')
                .attr('cx', city.x * scale)
                .attr('cy', city.y)
                .attr('r', 5)
                .attr('fill', '#1a1a1a')
                .attr('stroke', '#fff')
                .attr('stroke-width', 2);

            // City label
            svg.append('text')
                .attr('x', city.x * scale + 8)
                .attr('y', city.y + 4)
                .attr('font-size', '11px')
                .attr('font-weight', '600')
                .attr('fill', '#1a1a1a')
                .text(city.name);
        });

        // Show traffic info
        function showTrafficInfo(highway, segment) {
            const infoDiv = document.getElementById('traffic-info');
            const flowColor = getFlowColor(segment.flow);
            const flowStatus = segment.flow < 1000 ? 'Free flow' :
                               segment.flow < 2000 ? 'Moderate traffic' :
                               segment.flow < 3000 ? 'Heavy traffic' : 'Congested';

            let html = `
                <div style="font-weight: 700; font-size: 14px; color: #1a1a1a; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid ${flowColor};">
                    ${highway.name}
                </div>
                <div style="margin-bottom: 12px;">
                    <div style="font-weight: 600; margin-bottom: 4px;">Segment: ${segment.from} → ${segment.to}</div>
                    <div style="font-size: 12px; color: #666;">Traffic Flow</div>
                </div>
                <div style="background: white; padding: 12px; border-left: 4px solid ${flowColor}; margin-bottom: 12px;">
                    <div style="font-size: 24px; font-weight: 700; color: #1a1a1a; margin-bottom: 4px;">
                        ${segment.flow.toLocaleString()}
                    </div>
                    <div style="font-size: 12px; color: #666;">vehicles/hour</div>
                    <div style="font-size: 13px; font-weight: 600; color: ${flowColor}; margin-top: 8px;">
                        ${flowStatus}
                    </div>
                </div>
                <div style="font-size: 11px; color: #999; font-style: italic;">
                    Data simulated for demonstration. Real-time API integration available via FEDRO TDP.
                </div>
            `;

            infoDiv.innerHTML = html;
        }

        // Highway filter
        document.getElementById('highway-selector').addEventListener('change', (e) => {
            const selected = e.target.value;
            if (selected === 'all') {
                svg.selectAll('line').attr('opacity', 0.8);
            } else {
                svg.selectAll('line').attr('opacity', 0.1);
                svg.selectAll(`.highway-${selected}`).attr('opacity', 0.8);
            }
        });

        // Simulate real-time updates (updates flow every 5 seconds)
        function updateTrafficFlow() {
            highways.forEach(highway => {
                highway.segments.forEach(segment => {
                    // Simulate flow changes (+/- 10%)
                    const change = (Math.random() - 0.5) * 200;
                    segment.flow = Math.max(500, Math.min(4000, segment.flow + change));
                });
            });

            // Update visualization
            segmentGroup.selectAll('line').each(function(d, i) {
                let segmentIdx = 0;
                let currentHighway = null;

                for (const hw of highways) {
                    for (const seg of hw.segments) {
                        if (segmentIdx === i) {
                            currentHighway = hw;
                            d3.select(this)
                                .transition()
                                .duration(1000)
                                .attr('stroke', getFlowColor(seg.flow))
                                .attr('stroke-width', getFlowWidth(seg.flow));
                            return;
                        }
                        segmentIdx++;
                    }
                }
            });
        }

        // Update every 5 seconds
        setInterval(updateTrafficFlow, 5000);

        // Hide loading indicator
        setTimeout(() => {
            document.getElementById('loading-traffic').style.display = 'none';
        }, 1000);

        // Responsive resize
        window.addEventListener('resize', () => {
            const newWidth = container.offsetWidth || 700;
            svg.attr('width', newWidth);
        });
    </script>
</body>
</html>
