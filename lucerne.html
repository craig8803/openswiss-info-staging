<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canton of Lucerne - OpenSwiss.info</title>
    <meta name="description" content="Canton of Lucerne overview and municipalities">
    <link rel="stylesheet" href="styles.css">

    <!-- Leaflet CSS for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Leaflet JS for interactive maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <div class="logo">open <span class="swiss">swiss</span> info</div>
                <div class="language-bar">
                    <div class="language-links">
                        <a href="#de">DE</a>
                        <span>|</span>
                        <a href="#fr">FR</a>
                        <span>|</span>
                        <a href="#it">IT</a>
                        <span>|</span>
                        <a href="#en" class="active">EN</a>
                    </div>
                </div>
            </div>
            <nav class="nav">
                <div class="nav-item">
                    <a href="index.html">Home</a>
                </div>
                <div class="nav-item">
                    <a href="place.html" class="active">Location</a>
                    <div class="dropdown">
                        <a href="#canton-lucerne">Canton of Lucerne</a>
                        <div class="dropdown-item">
                            <a href="#lucerne-city" style="padding-left: 32px;">Lucerne (city)</a>
                            <div class="subdropdown">
                                <a href="#rules">Rules</a>
                                <a href="#national" style="padding-left: 32px;">National</a>
                                <a href="#cantonal" style="padding-left: 32px;">Cantonal</a>
                                <a href="#municipal" style="padding-left: 32px;">Municipal</a>
                            </div>
                        </div>
                        <div class="dropdown-item">
                            <a href="#kriens" style="padding-left: 32px;">Kriens</a>
                            <div class="subdropdown">
                                <a href="#rules-kriens">Rules</a>
                                <a href="#national-kriens" style="padding-left: 32px;">National</a>
                                <a href="#cantonal-kriens" style="padding-left: 32px;">Cantonal</a>
                                <a href="#municipal-kriens" style="padding-left: 32px;">Municipal</a>
                            </div>
                        </div>
                        <div class="dropdown-item">
                            <a href="#emmen" style="padding-left: 32px;">Emmen</a>
                            <div class="subdropdown">
                                <a href="#rules-emmen">Rules</a>
                                <a href="#national-emmen" style="padding-left: 32px;">National</a>
                                <a href="#cantonal-emmen" style="padding-left: 32px;">Cantonal</a>
                                <a href="#municipal-emmen" style="padding-left: 32px;">Municipal</a>
                            </div>
                        </div>
                        <a href="#canton-nidwalden">Canton of Nidwalden</a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="#data">Data</a>
                    <div class="dropdown">
                        <a href="#demographics">demographics</a>
                        <a href="#politics">politics</a>
                        <a href="#culture">culture</a>
                        <a href="#economy">economy</a>
                        <a href="#geography">geography</a>
                        <a href="#education">education</a>
                        <a href="#healthcare">healthcare</a>
                        <a href="#environment">environment</a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="visualizations.html">Visualizations</a>
                    <div class="dropdown">
                        <a href="visualizations.html">rail</a>
                        <a href="traffic.html">road</a>
                    </div>
                </div>
            </nav>
        </header>

        <div class="graph-panel">
            <h2 class="panel-title">Quick Facts</h2>
            <div style="padding: 20px;">
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 16px; margin-bottom: 16px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #1a1a1a;">Capital</h3>
                    <p style="font-size: 13px; color: #666;">Lucerne</p>
                </div>
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 16px; margin-bottom: 16px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #1a1a1a;">Population</h3>
                    <p style="font-size: 13px; color: #666;">~410,000</p>
                </div>
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 16px; margin-bottom: 16px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #1a1a1a;">Area</h3>
                    <p style="font-size: 13px; color: #666;">1,493 km²</p>
                </div>
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 16px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #1a1a1a;">Municipalities</h3>
                    <p style="font-size: 13px; color: #666;">79</p>
                </div>
                <div style="background: white; border: 1px solid #e0e0e0; padding: 16px; margin-top: 16px; text-align: center;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: #1a1a1a;">Flag</h3>
                    <svg width="120" height="80" viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
                        <!-- Canton Lucerne flag: white and blue horizontal stripes -->
                        <!-- White stripe (top) -->
                        <rect x="0" y="0" width="120" height="40" fill="white" stroke="#ddd" stroke-width="1"/>

                        <!-- Blue stripe (bottom) -->
                        <rect x="0" y="40" width="120" height="40" fill="#0066CC"/>

                        <!-- Border -->
                        <rect x="0" y="0" width="120" height="80" fill="none" stroke="#333" stroke-width="2"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="chat-panel">
            <div class="chat-header">
                <h1 class="chat-title">Canton of Lucerne</h1>
                <p class="chat-subtitle">Central Switzerland canton</p>
            </div>

            <div style="flex: 1;">
                <!-- Overview Facts -->
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 24px; margin-bottom: 24px;">
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">Overview</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Official Languages</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">German</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Joined Confederation</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">1332</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Region</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Central Switzerland</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Abbreviation</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">LU</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Districts</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">5 (Entlebuch, Hochdorf, Lucerne, Sursee, Willisau)</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Bordering Cantons</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Aargau, Bern, Nidwalden, Obwalden, Schwyz, Zug</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Highest Point</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Brienzer Rothorn (2,350 m)</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Lowest Point</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Lake Lucerne (434 m)</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Major Cities</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Lucerne, Emmen, Kriens, Horw</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Government</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Cantonal Council (120 seats)</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Executive Council</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">5 members</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">GDP per Capita</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">CHF 82,000 (approx.)</p>
                        </div>
                    </div>
                </div>

                <!-- Interactive Map -->
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 24px; margin-bottom: 24px;">
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">Canton Map</h3>
                    <div id="canton-map" style="width: 100%; height: 500px; border: 1px solid #e0e0e0; border-radius: 4px; overflow: hidden;"></div>
                    <div id="municipality-info" style="margin-top: 16px; padding: 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; min-height: 60px;">
                        <p style="font-size: 13px; color: #666; text-align: center;">Click on the map to explore Canton Lucerne</p>
                    </div>
                </div>

                <!-- Districts -->
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 24px; margin-bottom: 24px;">
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">
                        Districts
                        <span style="font-size: 14px; font-weight: 400; color: #999;">(5 districts)</span>
                    </h3>
                    <div id="districts-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
                        <!-- District tiles will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Municipalities List -->
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 24px;">
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">
                        Municipalities
                        <span style="font-size: 14px; font-weight: 400; color: #999;">(79 total, <span id="mapped-count">23</span> on map)</span>
                    </h3>
                    <div id="municipalities-container">
                        <!-- Municipality sections grouped by district will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <div class="citations-panel">
            <h2 class="panel-title">About Lucerne</h2>
            <div class="citations-list">
                <div class="citation">
                    <div class="citation-number">[1]</div>
                    <div class="citation-title">Geography</div>
                    <div class="citation-excerpt">
                        Located in central Switzerland, the canton is known for Lake Lucerne and its surrounding Alpine landscape.
                    </div>
                </div>
                <div class="citation">
                    <div class="citation-number">[2]</div>
                    <div class="citation-title">Economy</div>
                    <div class="citation-excerpt">
                        Major economic sectors include tourism, services, and manufacturing. The canton is home to several international companies.
                    </div>
                </div>
                <div class="citation">
                    <div class="citation-number">[3]</div>
                    <div class="citation-title">Featured Municipalities</div>
                    <div class="citation-excerpt">
                        Lucerne (city) is highlighted in red as the featured pilot municipality for this platform.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Leaflet map centered on Canton Lucerne
        // Lucerne city coordinates: 47.0502° N, 8.3093° E
        const map = L.map('canton-map').setView([47.0502, 8.3093], 10);

        // Add OpenStreetMap tile layer (completely free and open source) with grayscale filter
        const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19,
            className: 'grayscale-tiles'
        }).addTo(map);

        // Canton Lucerne detailed boundary polygon
        // Based on actual canton geography with Lake Lucerne indentations
        const cantonBoundary = [
            // Northwest corner (border with Aargau)
            [47.2550, 7.9400],
            [47.2520, 7.9650],
            [47.2480, 7.9900],
            [47.2450, 8.0150],

            // North (approaching Lake Lucerne)
            [47.2420, 8.0400],
            [47.2380, 8.0650],
            [47.2340, 8.0850],
            [47.2280, 8.1050],
            [47.2200, 8.1250],
            [47.2120, 8.1450],

            // Northern indentation (Lake Lucerne - western shore)
            [47.2040, 8.1650],
            [47.1950, 8.1850],
            [47.1850, 8.2050],
            [47.1760, 8.2250],
            [47.1680, 8.2450],
            [47.1620, 8.2650],

            // Around Lucerne city (Lake Lucerne narrows)
            [47.1580, 8.2850],
            [47.1560, 8.3050],
            [47.1550, 8.3250],
            [47.1580, 8.3450],
            [47.1620, 8.3650],

            // Northeast (Lake Lucerne - eastern shore)
            [47.1680, 8.3850],
            [47.1760, 8.4050],
            [47.1840, 8.4200],
            [47.1920, 8.4350],
            [47.2000, 8.4480],
            [47.2080, 8.4580],

            // Eastern boundary (border with Schwyz and Zug)
            [47.2140, 8.4680],
            [47.2180, 8.4750],
            [47.2200, 8.4820],
            [47.2180, 8.4920],
            [47.2140, 8.5020],
            [47.2080, 8.5100],
            [47.2000, 8.5150],
            [47.1900, 8.5180],
            [47.1800, 8.5180],
            [47.1700, 8.5150],
            [47.1600, 8.5100],
            [47.1500, 8.5050],
            [47.1400, 8.5000],

            // Southeast (Hochdorf area)
            [47.1300, 8.4950],
            [47.1200, 8.4900],
            [47.1100, 8.4850],
            [47.1000, 8.4800],
            [47.0900, 8.4750],
            [47.0800, 8.4700],
            [47.0700, 8.4650],
            [47.0600, 8.4600],

            // South-central (Sursee area)
            [47.0500, 8.4500],
            [47.0400, 8.4350],
            [47.0320, 8.4150],
            [47.0250, 8.3950],
            [47.0200, 8.3750],
            [47.0150, 8.3550],
            [47.0100, 8.3350],
            [47.0050, 8.3150],

            // Southwest (Willisau area)
            [47.0000, 8.2950],
            [46.9950, 8.2750],
            [46.9920, 8.2550],
            [46.9900, 8.2350],
            [46.9880, 8.2150],
            [46.9850, 8.1950],
            [46.9820, 8.1750],
            [46.9800, 8.1550],

            // South (Entlebuch valley - southernmost extension)
            [46.9780, 8.1350],
            [46.9750, 8.1150],
            [46.9720, 8.0950],
            [46.9700, 8.0750],
            [46.9680, 8.0550],
            [46.9650, 8.0350],
            [46.9620, 8.0150],
            [46.9600, 7.9950],

            // Southwest corner (Entlebuch)
            [46.9580, 7.9750],
            [46.9570, 7.9550],
            [46.9580, 7.9350],
            [46.9600, 7.9150],
            [46.9650, 7.8950],
            [46.9720, 7.8800],

            // West (border with Bern)
            [46.9800, 7.8700],
            [46.9900, 7.8650],
            [47.0000, 7.8650],
            [47.0100, 7.8700],
            [47.0200, 7.8750],
            [47.0300, 7.8850],
            [47.0400, 7.8950],
            [47.0500, 7.9050],
            [47.0600, 7.9150],

            // Northwest (continuing west border with Bern and Aargau)
            [47.0700, 7.9200],
            [47.0800, 7.9250],
            [47.0900, 7.9280],
            [47.1000, 7.9300],
            [47.1100, 7.9320],
            [47.1200, 7.9340],
            [47.1300, 7.9360],
            [47.1400, 7.9380],
            [47.1500, 7.9400],
            [47.1600, 7.9420],
            [47.1700, 7.9440],
            [47.1800, 7.9450],
            [47.1900, 7.9450],
            [47.2000, 7.9440],
            [47.2100, 7.9420],
            [47.2200, 7.9400],
            [47.2300, 7.9400],
            [47.2400, 7.9400]
        ];

        // Add canton border as red polygon
        const cantonPolygon = L.polygon(cantonBoundary, {
            color: '#dc2626',
            weight: 3,
            fillColor: '#dc2626',
            fillOpacity: 0.05,
            opacity: 0.8
        }).addTo(map);

        // Add popup to canton border
        cantonPolygon.bindPopup('<div style="text-align: center;"><strong>Canton of Lucerne</strong><br><span style="font-size: 12px; color: #666;">Area: 1,493 km²</span></div>');

        // All 79 municipalities with their coordinates
        const municipalities = [
            // District: Lucerne (17 municipalities)
            { name: 'Lucerne', lat: 47.0502, lon: 8.3093, district: 'Lucerne', type: 'city' },
            { name: 'Adligenswil', lat: 47.0626, lon: 8.3606, district: 'Lucerne', type: 'municipality' },
            { name: 'Buchrain', lat: 47.0992, lon: 8.3386, district: 'Lucerne', type: 'municipality' },
            { name: 'Dierikon', lat: 47.0711, lon: 8.3447, district: 'Lucerne', type: 'municipality' },
            { name: 'Ebikon', lat: 47.0798, lon: 8.3395, district: 'Lucerne', type: 'town' },
            { name: 'Emmen', lat: 47.0808, lon: 8.3009, district: 'Lucerne', type: 'town' },
            { name: 'Greppen', lat: 47.0253, lon: 8.4161, district: 'Lucerne', type: 'municipality' },
            { name: 'Honau', lat: 47.0289, lon: 8.2450, district: 'Lucerne', type: 'municipality' },
            { name: 'Horw', lat: 47.0173, lon: 8.3097, district: 'Lucerne', type: 'town' },
            { name: 'Kriens', lat: 47.0357, lon: 8.2789, district: 'Lucerne', type: 'town' },
            { name: 'Malters', lat: 47.0371, lon: 8.1869, district: 'Lucerne', type: 'municipality' },
            { name: 'Meggen', lat: 47.0426, lon: 8.3761, district: 'Lucerne', type: 'municipality' },
            { name: 'Meierskappel', lat: 47.1053, lon: 8.3717, district: 'Lucerne', type: 'municipality' },
            { name: 'Root', lat: 47.1108, lon: 8.3878, district: 'Lucerne', type: 'municipality' },
            { name: 'Schwarzenberg', lat: 47.0144, lon: 8.2167, district: 'Lucerne', type: 'municipality' },
            { name: 'Udligenswil', lat: 47.0861, lon: 8.3897, district: 'Lucerne', type: 'municipality' },
            { name: 'Vitznau', lat: 47.0073, lon: 8.4859, district: 'Lucerne', type: 'municipality' },
            { name: 'Weggis', lat: 47.0306, lon: 8.4364, district: 'Lucerne', type: 'municipality' },

            // District: Hochdorf (14 municipalities)
            { name: 'Hochdorf', lat: 47.1675, lon: 8.2944, district: 'Hochdorf', type: 'town' },
            { name: 'Aesch', lat: 47.1389, lon: 8.2792, district: 'Hochdorf', type: 'municipality' },
            { name: 'Ballwil', lat: 47.1542, lon: 8.3372, district: 'Hochdorf', type: 'municipality' },
            { name: 'Ermensee', lat: 47.1861, lon: 8.2542, district: 'Hochdorf', type: 'municipality' },
            { name: 'Eschenbach', lat: 47.1347, lon: 8.3186, district: 'Hochdorf', type: 'municipality' },
            { name: 'Gelfingen', lat: 47.1928, lon: 8.2694, district: 'Hochdorf', type: 'municipality' },
            { name: 'Hitzkirch', lat: 47.2225, lon: 8.2667, district: 'Hochdorf', type: 'municipality' },
            { name: 'Hohenrain', lat: 47.2297, lon: 8.3133, district: 'Hochdorf', type: 'municipality' },
            { name: 'Inwil', lat: 47.1189, lon: 8.3458, district: 'Hochdorf', type: 'municipality' },
            { name: 'Rain', lat: 47.1508, lon: 8.3056, district: 'Hochdorf', type: 'municipality' },
            { name: 'Römerswil', lat: 47.1983, lon: 8.2169, district: 'Hochdorf', type: 'municipality' },
            { name: 'Rothenburg', lat: 47.0978, lon: 8.2639, district: 'Hochdorf', type: 'municipality' },

            // District: Sursee (17 municipalities)
            { name: 'Sursee', lat: 47.1711, lon: 8.1097, district: 'Sursee', type: 'town' },
            { name: 'Beromünster', lat: 47.2081, lon: 8.1883, district: 'Sursee', type: 'municipality' },
            { name: 'Büron', lat: 47.1847, lon: 8.0856, district: 'Sursee', type: 'municipality' },
            { name: 'Buttisholz', lat: 47.1150, lon: 8.0989, district: 'Sursee', type: 'municipality' },
            { name: 'Eich', lat: 47.1536, lon: 8.1622, district: 'Sursee', type: 'municipality' },
            { name: 'Geuensee', lat: 47.1819, lon: 8.2183, district: 'Sursee', type: 'municipality' },
            { name: 'Grosswangen', lat: 47.1442, lon: 8.0472, district: 'Sursee', type: 'municipality' },
            { name: 'Gunzwil', lat: 47.2028, lon: 8.0711, district: 'Sursee', type: 'municipality' },
            { name: 'Hildisrieden', lat: 47.1028, lon: 8.2486, district: 'Sursee', type: 'municipality' },
            { name: 'Knutwil', lat: 47.1972, lon: 8.0525, district: 'Sursee', type: 'municipality' },
            { name: 'Mauensee', lat: 47.1739, lon: 8.0686, district: 'Sursee', type: 'municipality' },
            { name: 'Neuenkirch', lat: 47.1008, lon: 8.2042, district: 'Sursee', type: 'municipality' },
            { name: 'Nottwil', lat: 47.1367, lon: 8.1350, district: 'Sursee', type: 'municipality' },
            { name: 'Oberkirch', lat: 47.1592, lon: 8.1281, district: 'Sursee', type: 'municipality' },
            { name: 'Rickenbach', lat: 47.1892, lon: 8.0322, district: 'Sursee', type: 'municipality' },
            { name: 'Schenkon', lat: 47.1211, lon: 8.1994, district: 'Sursee', type: 'municipality' },
            { name: 'Schlierbach', lat: 47.1578, lon: 8.0897, district: 'Sursee', type: 'municipality' },
            { name: 'Sempach', lat: 47.1314, lon: 8.1889, district: 'Sursee', type: 'municipality' },
            { name: 'Triengen', lat: 47.2311, lon: 8.0789, district: 'Sursee', type: 'municipality' },

            // District: Willisau (22 municipalities)
            { name: 'Willisau', lat: 47.1219, lon: 7.9939, district: 'Willisau', type: 'town' },
            { name: 'Alberswil', lat: 47.1564, lon: 7.9964, district: 'Willisau', type: 'municipality' },
            { name: 'Altbüron', lat: 47.1844, lon: 7.9308, district: 'Willisau', type: 'municipality' },
            { name: 'Altishofen', lat: 47.1942, lon: 7.9758, district: 'Willisau', type: 'municipality' },
            { name: 'Dagmersellen', lat: 47.2153, lon: 7.9867, district: 'Willisau', type: 'municipality' },
            { name: 'Egolzwil', lat: 47.1817, lon: 8.0028, district: 'Willisau', type: 'municipality' },
            { name: 'Ettiswil', lat: 47.1408, lon: 7.9658, district: 'Willisau', type: 'municipality' },
            { name: 'Fischbach', lat: 47.1169, lon: 7.9508, district: 'Willisau', type: 'municipality' },
            { name: 'Gettnau', lat: 47.1164, lon: 8.0317, district: 'Willisau', type: 'municipality' },
            { name: 'Grossdietwil', lat: 47.1661, lon: 7.9281, district: 'Willisau', type: 'municipality' },
            { name: 'Hergiswil bei Willisau', lat: 47.0928, lon: 8.0119, district: 'Willisau', type: 'municipality' },
            { name: 'Luthern', lat: 47.0889, lon: 7.9661, district: 'Willisau', type: 'municipality' },
            { name: 'Menznau', lat: 47.0892, lon: 8.0450, district: 'Willisau', type: 'municipality' },
            { name: 'Nebikon', lat: 47.1919, lon: 7.9950, district: 'Willisau', type: 'municipality' },
            { name: 'Ohmstal', lat: 47.2183, lon: 7.9556, district: 'Willisau', type: 'municipality' },
            { name: 'Pfaffnau', lat: 47.2267, lon: 7.9050, district: 'Willisau', type: 'municipality' },
            { name: 'Reiden', lat: 47.2431, lon: 7.9656, district: 'Willisau', type: 'municipality' },
            { name: 'Roggliswil', lat: 47.1061, lon: 8.0056, district: 'Willisau', type: 'municipality' },
            { name: 'Schötz', lat: 47.1667, lon: 8.0167, district: 'Willisau', type: 'municipality' },
            { name: 'Uffikon', lat: 47.1500, lon: 8.0192, district: 'Willisau', type: 'municipality' },
            { name: 'Wauwil', lat: 47.1806, lon: 8.0358, district: 'Willisau', type: 'municipality' },
            { name: 'Winikon', lat: 47.1383, lon: 8.0725, district: 'Willisau', type: 'municipality' },
            { name: 'Zell', lat: 47.1358, lon: 7.9436, district: 'Willisau', type: 'municipality' },

            // District: Entlebuch (9 municipalities)
            { name: 'Entlebuch', lat: 46.9972, lon: 8.0556, district: 'Entlebuch', type: 'town' },
            { name: 'Doppleschwand', lat: 46.9372, lon: 8.0758, district: 'Entlebuch', type: 'municipality' },
            { name: 'Escholzmatt-Marbach', lat: 46.9122, lon: 8.0192, district: 'Entlebuch', type: 'municipality' },
            { name: 'Flühli', lat: 46.8806, lon: 8.0114, district: 'Entlebuch', type: 'municipality' },
            { name: 'Hasle', lat: 47.0264, lon: 8.0661, district: 'Entlebuch', type: 'municipality' },
            { name: 'Romoos', lat: 47.0014, lon: 7.9883, district: 'Entlebuch', type: 'municipality' },
            { name: 'Ruswil', lat: 47.0850, lon: 8.1289, district: 'Entlebuch', type: 'municipality' },
            { name: 'Schüpfheim', lat: 46.9503, lon: 8.0169, district: 'Entlebuch', type: 'municipality' },
            { name: 'Werthenstein', lat: 47.0492, lon: 8.1242, district: 'Entlebuch', type: 'municipality' },
            { name: 'Wolhusen', lat: 47.0606, lon: 8.0758, district: 'Entlebuch', type: 'municipality' }
        ];

        // Add markers for municipalities
        municipalities.forEach(municipality => {
            let markerColor = '#666666';
            let markerSize = 8;

            if (municipality.type === 'city') {
                markerColor = '#dc2626';
                markerSize = 12;
            } else if (municipality.type === 'town') {
                markerColor = '#888888';
                markerSize = 10;
            }

            // Create custom icon
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="
                    width: ${markerSize}px;
                    height: ${markerSize}px;
                    background: ${markerColor};
                    border: 2px solid white;
                    border-radius: 50%;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                    transition: all 0.2s;
                "></div>`,
                iconSize: [markerSize, markerSize],
                iconAnchor: [markerSize/2, markerSize/2]
            });

            const marker = L.marker([municipality.lat, municipality.lon], { icon: icon })
                .addTo(map);

            // Add popup
            const popupContent = `
                <div style="min-width: 150px;">
                    <h4 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: #1a1a1a;">${municipality.name}</h4>
                    <p style="margin: 0; font-size: 13px; color: #666;">District: ${municipality.district}</p>
                    <p style="margin: 4px 0 0 0; font-size: 12px; color: #999;">Type: ${municipality.type}</p>
                </div>
            `;

            marker.bindPopup(popupContent);

            // Update info panel on hover
            marker.on('mouseover', function() {
                const infoPanel = document.getElementById('municipality-info');
                infoPanel.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="font-size: 16px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;">${municipality.name}</h4>
                            <p style="font-size: 13px; color: #666;">District: ${municipality.district}</p>
                        </div>
                        <div style="text-align: right;">
                            <span style="font-size: 11px; color: #999; text-transform: capitalize;">${municipality.type}</span>
                        </div>
                    </div>
                `;
            });

            marker.on('mouseout', function() {
                const infoPanel = document.getElementById('municipality-info');
                infoPanel.innerHTML = '<p style="font-size: 13px; color: #666; text-align: center;">Click on the map to explore Canton Lucerne</p>';
            });
        });

        // Add custom styles for popups and grayscale map
        const style = document.createElement('style');
        style.textContent = `
            /* Grayscale filter for map tiles */
            .grayscale-tiles {
                filter: grayscale(100%) contrast(1.1) brightness(1.05);
                -webkit-filter: grayscale(100%) contrast(1.1) brightness(1.05);
            }

            .leaflet-popup-content-wrapper {
                border-radius: 4px;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            }
            .leaflet-popup-content {
                margin: 12px;
            }
            .custom-marker div:hover {
                transform: scale(1.3);
            }

            /* Municipality tile styles */
            .municipality-tile {
                padding: 10px 12px;
                background: white;
                color: #666;
                text-decoration: none;
                border: 1px solid #e0e0e0;
                border-radius: 4px;
                font-size: 13px;
                transition: all 0.2s;
                cursor: pointer;
                font-family: inherit;
                text-align: left;
            }

            .municipality-tile:hover {
                background: #f5f5f5;
                border-color: #999;
                transform: translateY(-1px);
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .municipality-tile.mapped {
                border-left: 3px solid #dc2626;
                background: #fffbfb;
            }

            .municipality-tile.mapped:hover {
                background: #fff5f5;
                border-color: #dc2626;
            }

            .municipality-tile.active {
                background: #dc2626;
                color: white;
                border-color: #dc2626;
            }

            .municipality-tile.lucerne-city {
                background: #dc2626;
                color: white;
                border-color: #dc2626;
                font-weight: 600;
            }

            .municipality-tile.lucerne-city:hover {
                background: #b91c1c;
            }

            .district-tile {
                background: white;
                border: 1px solid #e0e0e0;
                padding: 16px;
                border-radius: 4px;
                cursor: pointer;
                transition: all 0.2s;
                text-align: left;
            }

            .district-tile:hover {
                border-color: #dc2626;
                box-shadow: 0 2px 8px rgba(220, 38, 38, 0.15);
                transform: translateY(-2px);
            }

            .district-tile.active {
                background: #dc2626;
                color: white;
                border-color: #dc2626;
            }

            .district-name {
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 8px;
                color: #1a1a1a;
            }

            .district-tile.active .district-name {
                color: white;
            }

            .district-info {
                font-size: 13px;
                color: #666;
            }

            .district-tile.active .district-info {
                color: rgba(255, 255, 255, 0.9);
            }

            .district-section {
                margin-bottom: 24px;
            }

            .district-header {
                background: white;
                border: 1px solid #e0e0e0;
                padding: 16px;
                border-radius: 4px;
                cursor: pointer;
                display: flex;
                justify-content: space-between;
                align-items: center;
                transition: all 0.2s;
                margin-bottom: 12px;
            }

            .district-header:hover {
                border-color: #dc2626;
                box-shadow: 0 2px 4px rgba(220, 38, 38, 0.1);
            }

            .district-header-title {
                font-size: 18px;
                font-weight: 600;
                color: #1a1a1a;
            }

            .district-header-count {
                font-size: 14px;
                color: #666;
            }

            .district-toggle {
                font-size: 20px;
                color: #666;
                transition: transform 0.2s;
            }

            .district-header.collapsed .district-toggle {
                transform: rotate(-90deg);
            }

            .district-municipalities {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 8px;
                padding-left: 16px;
            }

            .district-municipalities.hidden {
                display: none;
            }
        `;
        document.head.appendChild(style);

        // District data with center coordinates for map navigation
        const districts = [
            { name: 'Lucerne', lat: 47.0502, lon: 8.3093, municipalityCount: 18, description: 'Central district including Lucerne city' },
            { name: 'Hochdorf', lat: 47.1667, lon: 8.3000, municipalityCount: 12, description: 'Eastern district bordering Zug and Aargau' },
            { name: 'Sursee', lat: 47.1711, lon: 8.1097, municipalityCount: 19, description: 'Northern district around Lake Sempach' },
            { name: 'Willisau', lat: 47.1167, lon: 7.9833, municipalityCount: 23, description: 'Western district bordering Bern' },
            { name: 'Entlebuch', lat: 46.9972, lon: 8.0556, municipalityCount: 10, description: 'Southern alpine valley district' }
        ];

        // Generate district tiles
        const districtsGrid = document.getElementById('districts-grid');
        districts.forEach(district => {
            const tile = document.createElement('div');
            tile.className = 'district-tile';
            tile.innerHTML = `
                <div class="district-name">${district.name}</div>
                <div class="district-info">${district.municipalityCount} municipalities</div>
                <div class="district-info" style="margin-top: 4px; font-size: 12px;">${district.description}</div>
            `;

            tile.addEventListener('click', () => {
                // Remove active class from all district tiles
                document.querySelectorAll('.district-tile').forEach(t => t.classList.remove('active'));
                tile.classList.add('active');

                // Zoom to district on map
                map.setView([district.lat, district.lon], 11, { animate: true });

                // Update info panel
                const infoPanel = document.getElementById('municipality-info');
                infoPanel.innerHTML = `
                    <div style="text-align: center;">
                        <h4 style="font-size: 16px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;">${district.name} District</h4>
                        <p style="font-size: 13px; color: #666;">${district.municipalityCount} municipalities • ${district.description}</p>
                    </div>
                `;

                // Scroll to the district's municipalities section
                const districtSection = document.getElementById(`district-${district.name.toLowerCase()}`);
                if (districtSection) {
                    districtSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    // Expand the section if collapsed
                    const header = districtSection.querySelector('.district-header');
                    const munsContainer = districtSection.querySelector('.district-municipalities');
                    if (header.classList.contains('collapsed')) {
                        header.classList.remove('collapsed');
                        munsContainer.classList.remove('hidden');
                    }
                }
            });

            districtsGrid.appendChild(tile);
        });

        // Complete list of all 79 municipalities in Canton Lucerne
        const allMunicipalities = [
            'Adligenswil', 'Aesch', 'Alberswil', 'Altbüron', 'Altishofen', 'Ballwil', 'Beromünster',
            'Buchrain', 'Buttisholz', 'Dagmersellen', 'Dierikon', 'Doppleschwand', 'Ebikon', 'Egolzwil',
            'Emmen', 'Entlebuch', 'Ermensee', 'Eschenbach', 'Escholzmatt-Marbach', 'Ettiswil', 'Fischbach',
            'Flühli', 'Gelfingen', 'Geuensee', 'Gettnau', 'Greppen', 'Grossdietwil', 'Grosswangen',
            'Gunzwil', 'Hasle', 'Hergiswil bei Willisau', 'Hildisrieden', 'Hochdorf', 'Hohenrain',
            'Honau', 'Horw', 'Inwil', 'Knutwil', 'Kriens', 'Lucerne', 'Luthern', 'Malters', 'Mauensee',
            'Meggen', 'Meierskappel', 'Menznau', 'Nebikon', 'Neuenkirch', 'Nottwil', 'Oberkirch',
            'Ohmstal', 'Pfaffnau', 'Rain', 'Rickenbach', 'Roggliswil', 'Romoos', 'Root', 'Rothenburg',
            'Ruswil', 'Schötz', 'Schenkon', 'Schlierbach', 'Schüpfheim', 'Schwarzenberg', 'Sempach',
            'Sursee', 'Triengen', 'Udligenswil', 'Uffikon', 'Vitznau', 'Wauwil', 'Weggis',
            'Werthenstein', 'Willisau', 'Winikon', 'Wolhusen', 'Zell'
        ];

        // Create a map of municipality names to their data
        const municipalityMap = {};
        const municipalityMarkers = {};

        municipalities.forEach(mun => {
            municipalityMap[mun.name] = mun;
        });

        // Group municipalities by district
        const municipalitiesByDistrict = {
            'Lucerne': [],
            'Hochdorf': [],
            'Sursee': [],
            'Willisau': [],
            'Entlebuch': []
        };

        allMunicipalities.forEach(name => {
            const munData = municipalityMap[name];
            if (munData && munData.district) {
                municipalitiesByDistrict[munData.district].push(name);
            } else {
                // If not in map data, try to guess from the municipalities array
                const found = municipalities.find(m => m.name === name);
                if (found) {
                    municipalitiesByDistrict[found.district].push(name);
                }
            }
        });

        // Generate municipality sections grouped by district
        const container = document.getElementById('municipalities-container');

        districts.forEach(district => {
            const districtMunicipalities = municipalitiesByDistrict[district.name] || [];

            const section = document.createElement('div');
            section.className = 'district-section';
            section.id = `district-${district.name.toLowerCase()}`;

            // District header (collapsible)
            const header = document.createElement('div');
            header.className = 'district-header';
            header.innerHTML = `
                <div>
                    <div class="district-header-title">${district.name}</div>
                    <div class="district-header-count">${districtMunicipalities.length} municipalities</div>
                </div>
                <div class="district-toggle">▼</div>
            `;

            // Toggle collapse on click
            header.addEventListener('click', () => {
                header.classList.toggle('collapsed');
                munsContainer.classList.toggle('hidden');
            });

            section.appendChild(header);

            // Municipalities grid for this district
            const munsContainer = document.createElement('div');
            munsContainer.className = 'district-municipalities';

            districtMunicipalities.forEach(name => {
                const tile = document.createElement('button');
                tile.className = 'municipality-tile';
                tile.textContent = name;

                // Check if this municipality is on the map
                const munData = municipalityMap[name];
                if (munData) {
                    tile.classList.add('mapped');
                    tile.title = 'Click to view on map';
                }

                // Special styling for Lucerne city
                if (name === 'Lucerne') {
                    tile.classList.add('lucerne-city');
                }

                // Add click handler
                tile.addEventListener('click', () => {
                    // Remove active class from all tiles
                    document.querySelectorAll('.municipality-tile').forEach(t => {
                        if (!t.classList.contains('lucerne-city')) {
                            t.classList.remove('active');
                        }
                    });

                    if (name === 'Lucerne') {
                        // Navigate to Lucerne city page
                        window.location.href = 'lucerne-city.html';
                        return;
                    }

                    if (munData) {
                        // Zoom to municipality on map
                        map.setView([munData.lat, munData.lon], 13, {
                            animate: true,
                            duration: 1
                        });

                        // Find and open the marker popup
                        const marker = municipalityMarkers[name];
                        if (marker) {
                            marker.openPopup();
                        }

                        // Mark tile as active
                        tile.classList.add('active');

                        // Update info panel
                        const infoPanel = document.getElementById('municipality-info');
                        infoPanel.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4 style="font-size: 16px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;">${munData.name}</h4>
                                    <p style="font-size: 13px; color: #666;">District: ${munData.district}</p>
                                </div>
                                <div style="text-align: right;">
                                    <span style="font-size: 11px; color: #999; text-transform: capitalize;">${munData.type}</span>
                                </div>
                            </div>
                        `;

                        // Scroll map into view
                        document.getElementById('canton-map').scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else {
                        // Show information for unmapped municipalities
                        const infoPanel = document.getElementById('municipality-info');
                        infoPanel.innerHTML = `
                            <div style="text-align: center;">
                                <h4 style="font-size: 16px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;">${name}</h4>
                                <p style="font-size: 13px; color: #999;">Location details coming soon</p>
                            </div>
                        `;
                    }
                });

                munsContainer.appendChild(tile);
            });

            section.appendChild(munsContainer);
            container.appendChild(section);
        });

        // Store marker references for later use
        municipalities.forEach(municipality => {
            const existingMarkers = map._layers;
            for (let id in existingMarkers) {
                const layer = existingMarkers[id];
                if (layer.getLatLng &&
                    layer.getLatLng().lat === municipality.lat &&
                    layer.getLatLng().lon === municipality.lon) {
                    municipalityMarkers[municipality.name] = layer;
                    break;
                }
            }
        });
    </script>
</body>
</html>
