<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canton of Lucerne - OpenSwiss.info</title>
    <meta name="description" content="Canton of Lucerne overview and municipalities">
    <link rel="stylesheet" href="styles.css">

    <!-- Leaflet CSS for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Leaflet JS for interactive maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <div class="logo">open <span class="swiss">swiss</span> info</div>
                <div class="language-bar">
                    <div class="language-links">
                        <a href="#de">DE</a>
                        <span>|</span>
                        <a href="#fr">FR</a>
                        <span>|</span>
                        <a href="#it">IT</a>
                        <span>|</span>
                        <a href="#en" class="active">EN</a>
                    </div>
                </div>
            </div>
            <nav class="nav">
                <div class="nav-item">
                    <a href="index.html">Home</a>
                </div>
                <div class="nav-item">
                    <a href="place.html" class="active">Location</a>
                    <div class="dropdown">
                        <a href="#canton-lucerne">Canton of Lucerne</a>
                        <div class="dropdown-item">
                            <a href="#lucerne-city" style="padding-left: 32px;">Lucerne (city)</a>
                            <div class="subdropdown">
                                <a href="#rules">Rules</a>
                                <a href="#national" style="padding-left: 32px;">National</a>
                                <a href="#cantonal" style="padding-left: 32px;">Cantonal</a>
                                <a href="#municipal" style="padding-left: 32px;">Municipal</a>
                            </div>
                        </div>
                        <div class="dropdown-item">
                            <a href="#kriens" style="padding-left: 32px;">Kriens</a>
                            <div class="subdropdown">
                                <a href="#rules-kriens">Rules</a>
                                <a href="#national-kriens" style="padding-left: 32px;">National</a>
                                <a href="#cantonal-kriens" style="padding-left: 32px;">Cantonal</a>
                                <a href="#municipal-kriens" style="padding-left: 32px;">Municipal</a>
                            </div>
                        </div>
                        <div class="dropdown-item">
                            <a href="#emmen" style="padding-left: 32px;">Emmen</a>
                            <div class="subdropdown">
                                <a href="#rules-emmen">Rules</a>
                                <a href="#national-emmen" style="padding-left: 32px;">National</a>
                                <a href="#cantonal-emmen" style="padding-left: 32px;">Cantonal</a>
                                <a href="#municipal-emmen" style="padding-left: 32px;">Municipal</a>
                            </div>
                        </div>
                        <a href="#canton-nidwalden">Canton of Nidwalden</a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="#data">Data</a>
                    <div class="dropdown">
                        <a href="#demographics">demographics</a>
                        <a href="#politics">politics</a>
                        <a href="#culture">culture</a>
                        <a href="#economy">economy</a>
                        <a href="#geography">geography</a>
                        <a href="#education">education</a>
                        <a href="#healthcare">healthcare</a>
                        <a href="#environment">environment</a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="visualizations.html">Visualizations</a>
                    <div class="dropdown">
                        <a href="visualizations.html">rail</a>
                        <a href="traffic.html">road</a>
                    </div>
                </div>
            </nav>
        </header>

        <div class="graph-panel">
            <h2 class="panel-title">Quick Facts</h2>
            <div style="padding: 20px;">
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 16px; margin-bottom: 16px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #1a1a1a;">Capital</h3>
                    <p style="font-size: 13px; color: #666;">Lucerne</p>
                </div>
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 16px; margin-bottom: 16px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #1a1a1a;">Population</h3>
                    <p style="font-size: 13px; color: #666;">~410,000</p>
                </div>
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 16px; margin-bottom: 16px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #1a1a1a;">Area</h3>
                    <p style="font-size: 13px; color: #666;">1,493 km²</p>
                </div>
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 16px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #1a1a1a;">Municipalities</h3>
                    <p style="font-size: 13px; color: #666;">79</p>
                </div>
                <div style="background: white; border: 1px solid #e0e0e0; padding: 16px; margin-top: 16px; text-align: center;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: #1a1a1a;">Coat of Arms</h3>
                    <svg width="120" height="140" viewBox="0 0 120 140" xmlns="http://www.w3.org/2000/svg">
                        <!-- Shield outline -->
                        <path d="M 10 10 L 110 10 L 110 90 Q 60 130 10 90 Z" fill="white" stroke="#333" stroke-width="2"/>

                        <!-- Diagonal division - white (top-left) and blue (bottom-right) -->
                        <defs>
                            <clipPath id="shield-clip">
                                <path d="M 10 10 L 110 10 L 110 90 Q 60 130 10 90 Z"/>
                            </clipPath>
                        </defs>

                        <!-- White half (top-left) -->
                        <polygon points="10,10 110,10 10,90" fill="white" clip-path="url(#shield-clip)"/>

                        <!-- Blue half (bottom-right) -->
                        <polygon points="110,10 110,90 60,130 10,90" fill="#0066CC" clip-path="url(#shield-clip)"/>

                        <!-- Shield border -->
                        <path d="M 10 10 L 110 10 L 110 90 Q 60 130 10 90 Z" fill="none" stroke="#333" stroke-width="2"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="chat-panel">
            <div class="chat-header">
                <h1 class="chat-title">Canton of Lucerne</h1>
                <p class="chat-subtitle">Central Switzerland canton</p>
            </div>

            <div style="flex: 1;">
                <!-- Overview Facts -->
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 24px; margin-bottom: 24px;">
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">Overview</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Official Languages</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">German</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Joined Confederation</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">1332</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Region</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Central Switzerland</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Abbreviation</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">LU</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Districts</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">5 (Entlebuch, Hochdorf, Lucerne, Sursee, Willisau)</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Bordering Cantons</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Aargau, Bern, Nidwalden, Obwalden, Schwyz, Zug</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Highest Point</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Brienzer Rothorn (2,350 m)</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Lowest Point</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Lake Lucerne (434 m)</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Major Cities</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Lucerne, Emmen, Kriens, Horw</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Government</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">Cantonal Council (120 seats)</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">Executive Council</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">5 members</p>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #666;">GDP per Capita</h4>
                            <p style="font-size: 14px; color: #1a1a1a;">CHF 82,000 (approx.)</p>
                        </div>
                    </div>
                </div>

                <!-- Interactive Map -->
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 24px; margin-bottom: 24px;">
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">Canton Map</h3>
                    <div id="canton-map" style="width: 100%; height: 500px; border: 1px solid #e0e0e0; border-radius: 4px; overflow: hidden;"></div>
                    <div id="municipality-info" style="margin-top: 16px; padding: 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; min-height: 60px;">
                        <p style="font-size: 13px; color: #666; text-align: center;">Click on the map to explore Canton Lucerne</p>
                    </div>
                </div>

                <!-- Municipalities List -->
                <div style="background: #fafafa; border: 1px solid #e0e0e0; padding: 24px;">
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">
                        Municipalities
                        <span style="font-size: 14px; font-weight: 400; color: #999;">(79 total, <span id="mapped-count">23</span> on map)</span>
                    </h3>
                    <div id="municipalities-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 8px;">
                        <!-- Municipality tiles will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <div class="citations-panel">
            <h2 class="panel-title">About Lucerne</h2>
            <div class="citations-list">
                <div class="citation">
                    <div class="citation-number">[1]</div>
                    <div class="citation-title">Geography</div>
                    <div class="citation-excerpt">
                        Located in central Switzerland, the canton is known for Lake Lucerne and its surrounding Alpine landscape.
                    </div>
                </div>
                <div class="citation">
                    <div class="citation-number">[2]</div>
                    <div class="citation-title">Economy</div>
                    <div class="citation-excerpt">
                        Major economic sectors include tourism, services, and manufacturing. The canton is home to several international companies.
                    </div>
                </div>
                <div class="citation">
                    <div class="citation-number">[3]</div>
                    <div class="citation-title">Featured Municipalities</div>
                    <div class="citation-excerpt">
                        Lucerne (city) is highlighted in red as the featured pilot municipality for this platform.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Leaflet map centered on Canton Lucerne
        // Lucerne city coordinates: 47.0502° N, 8.3093° E
        const map = L.map('canton-map').setView([47.0502, 8.3093], 10);

        // Add OpenStreetMap tile layer (completely free and open source) with grayscale filter
        const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19,
            className: 'grayscale-tiles'
        }).addTo(map);

        // Canton Lucerne approximate boundary (simplified polygon)
        // This is a rough approximation of the canton's borders
        const cantonBoundary = [
            [47.25, 7.95],   // Northwest
            [47.25, 8.00],
            [47.23, 8.05],
            [47.20, 8.10],
            [47.18, 8.15],
            [47.17, 8.20],
            [47.18, 8.25],
            [47.20, 8.30],
            [47.22, 8.35],
            [47.21, 8.40],
            [47.19, 8.45],
            [47.17, 8.48],
            [47.14, 8.50],   // East
            [47.11, 8.51],
            [47.08, 8.51],
            [47.05, 8.50],
            [47.02, 8.49],
            [46.99, 8.47],
            [46.97, 8.45],
            [46.95, 8.42],
            [46.93, 8.38],   // South
            [46.92, 8.33],
            [46.91, 8.28],
            [46.91, 8.23],
            [46.92, 8.18],
            [46.93, 8.13],
            [46.95, 8.08],
            [46.97, 8.03],
            [46.99, 7.98],   // West
            [47.02, 7.96],
            [47.06, 7.95],
            [47.10, 7.94],
            [47.14, 7.94],
            [47.18, 7.94],
            [47.22, 7.94]
        ];

        // Add canton border as red polygon
        const cantonPolygon = L.polygon(cantonBoundary, {
            color: '#dc2626',
            weight: 3,
            fillColor: '#dc2626',
            fillOpacity: 0.05,
            opacity: 0.8
        }).addTo(map);

        // Add popup to canton border
        cantonPolygon.bindPopup('<div style="text-align: center;"><strong>Canton of Lucerne</strong><br><span style="font-size: 12px; color: #666;">Area: 1,493 km²</span></div>');

        // Major municipalities with their coordinates
        const municipalities = [
            // Major cities
            { name: 'Lucerne', lat: 47.0502, lon: 8.3093, district: 'Lucerne', type: 'city' },
            { name: 'Kriens', lat: 47.0357, lon: 8.2789, district: 'Lucerne', type: 'town' },
            { name: 'Emmen', lat: 47.0808, lon: 8.3009, district: 'Lucerne', type: 'town' },
            { name: 'Horw', lat: 47.0173, lon: 8.3097, district: 'Lucerne', type: 'town' },

            // District: Lucerne
            { name: 'Ebikon', lat: 47.0798, lon: 8.3395, district: 'Lucerne', type: 'town' },
            { name: 'Adligenswil', lat: 47.0626, lon: 8.3606, district: 'Lucerne', type: 'municipality' },
            { name: 'Meggen', lat: 47.0426, lon: 8.3761, district: 'Lucerne', type: 'municipality' },
            { name: 'Weggis', lat: 47.0306, lon: 8.4364, district: 'Lucerne', type: 'municipality' },
            { name: 'Vitznau', lat: 47.0073, lon: 8.4859, district: 'Lucerne', type: 'municipality' },
            { name: 'Greppen', lat: 47.0253, lon: 8.4161, district: 'Lucerne', type: 'municipality' },
            { name: 'Malters', lat: 47.0371, lon: 8.1869, district: 'Lucerne', type: 'municipality' },

            // District: Hochdorf
            { name: 'Hochdorf', lat: 47.1675, lon: 8.2944, district: 'Hochdorf', type: 'town' },
            { name: 'Rothenburg', lat: 47.0978, lon: 8.2639, district: 'Hochdorf', type: 'municipality' },
            { name: 'Eschenbach', lat: 47.1347, lon: 8.3186, district: 'Hochdorf', type: 'municipality' },

            // District: Sursee
            { name: 'Sursee', lat: 47.1711, lon: 8.1097, district: 'Sursee', type: 'town' },
            { name: 'Sempach', lat: 47.1314, lon: 8.1889, district: 'Sursee', type: 'municipality' },
            { name: 'Beromünster', lat: 47.2081, lon: 8.1883, district: 'Sursee', type: 'municipality' },

            // District: Willisau
            { name: 'Willisau', lat: 47.1219, lon: 7.9939, district: 'Willisau', type: 'town' },
            { name: 'Schötz', lat: 47.1667, lon: 8.0167, district: 'Willisau', type: 'municipality' },

            // District: Entlebuch
            { name: 'Entlebuch', lat: 46.9972, lon: 8.0556, district: 'Entlebuch', type: 'town' },
            { name: 'Schüpfheim', lat: 46.9503, lon: 8.0169, district: 'Entlebuch', type: 'municipality' },
            { name: 'Wolhusen', lat: 47.0606, lon: 8.0758, district: 'Entlebuch', type: 'municipality' }
        ];

        // Add markers for municipalities
        municipalities.forEach(municipality => {
            let markerColor = '#666666';
            let markerSize = 8;

            if (municipality.type === 'city') {
                markerColor = '#dc2626';
                markerSize = 12;
            } else if (municipality.type === 'town') {
                markerColor = '#888888';
                markerSize = 10;
            }

            // Create custom icon
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="
                    width: ${markerSize}px;
                    height: ${markerSize}px;
                    background: ${markerColor};
                    border: 2px solid white;
                    border-radius: 50%;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                    transition: all 0.2s;
                "></div>`,
                iconSize: [markerSize, markerSize],
                iconAnchor: [markerSize/2, markerSize/2]
            });

            const marker = L.marker([municipality.lat, municipality.lon], { icon: icon })
                .addTo(map);

            // Add popup
            const popupContent = `
                <div style="min-width: 150px;">
                    <h4 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: #1a1a1a;">${municipality.name}</h4>
                    <p style="margin: 0; font-size: 13px; color: #666;">District: ${municipality.district}</p>
                    <p style="margin: 4px 0 0 0; font-size: 12px; color: #999;">Type: ${municipality.type}</p>
                </div>
            `;

            marker.bindPopup(popupContent);

            // Update info panel on hover
            marker.on('mouseover', function() {
                const infoPanel = document.getElementById('municipality-info');
                infoPanel.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="font-size: 16px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;">${municipality.name}</h4>
                            <p style="font-size: 13px; color: #666;">District: ${municipality.district}</p>
                        </div>
                        <div style="text-align: right;">
                            <span style="font-size: 11px; color: #999; text-transform: capitalize;">${municipality.type}</span>
                        </div>
                    </div>
                `;
            });

            marker.on('mouseout', function() {
                const infoPanel = document.getElementById('municipality-info');
                infoPanel.innerHTML = '<p style="font-size: 13px; color: #666; text-align: center;">Click on the map to explore Canton Lucerne</p>';
            });
        });

        // Add custom styles for popups and grayscale map
        const style = document.createElement('style');
        style.textContent = `
            /* Grayscale filter for map tiles */
            .grayscale-tiles {
                filter: grayscale(100%) contrast(1.1) brightness(1.05);
                -webkit-filter: grayscale(100%) contrast(1.1) brightness(1.05);
            }

            .leaflet-popup-content-wrapper {
                border-radius: 4px;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            }
            .leaflet-popup-content {
                margin: 12px;
            }
            .custom-marker div:hover {
                transform: scale(1.3);
            }

            /* Municipality tile styles */
            .municipality-tile {
                padding: 10px 12px;
                background: white;
                color: #666;
                text-decoration: none;
                border: 1px solid #e0e0e0;
                border-radius: 4px;
                font-size: 13px;
                transition: all 0.2s;
                cursor: pointer;
                font-family: inherit;
                text-align: left;
            }

            .municipality-tile:hover {
                background: #f5f5f5;
                border-color: #999;
                transform: translateY(-1px);
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .municipality-tile.mapped {
                border-left: 3px solid #dc2626;
                background: #fffbfb;
            }

            .municipality-tile.mapped:hover {
                background: #fff5f5;
                border-color: #dc2626;
            }

            .municipality-tile.active {
                background: #dc2626;
                color: white;
                border-color: #dc2626;
            }

            .municipality-tile.lucerne-city {
                background: #dc2626;
                color: white;
                border-color: #dc2626;
                font-weight: 600;
            }

            .municipality-tile.lucerne-city:hover {
                background: #b91c1c;
            }
        `;
        document.head.appendChild(style);

        // Complete list of all 79 municipalities in Canton Lucerne
        const allMunicipalities = [
            'Adligenswil', 'Aesch', 'Alberswil', 'Altbüron', 'Altishofen', 'Ballwil', 'Beromünster',
            'Buchrain', 'Buttisholz', 'Dagmersellen', 'Dierikon', 'Doppleschwand', 'Ebikon', 'Egolzwil',
            'Emmen', 'Entlebuch', 'Ermensee', 'Eschenbach', 'Escholzmatt-Marbach', 'Ettiswil', 'Fischbach',
            'Flühli', 'Gelfingen', 'Geuensee', 'Gettnau', 'Greppen', 'Grossdietwil', 'Grosswangen',
            'Gunzwil', 'Hasle', 'Hergiswil bei Willisau', 'Hildisrieden', 'Hochdorf', 'Hohenrain',
            'Honau', 'Horw', 'Inwil', 'Knutwil', 'Kriens', 'Lucerne', 'Luthern', 'Malters', 'Mauensee',
            'Meggen', 'Meierskappel', 'Menznau', 'Nebikon', 'Neuenkirch', 'Nottwil', 'Oberkirch',
            'Ohmstal', 'Pfaffnau', 'Rain', 'Rickenbach', 'Roggliswil', 'Romoos', 'Root', 'Rothenburg',
            'Ruswil', 'Schötz', 'Schenkon', 'Schlierbach', 'Schüpfheim', 'Schwarzenberg', 'Sempach',
            'Sursee', 'Triengen', 'Udligenswil', 'Uffikon', 'Vitznau', 'Wauwil', 'Weggis',
            'Werthenstein', 'Willisau', 'Winikon', 'Wolhusen', 'Zell'
        ];

        // Create a map of municipality names to their data
        const municipalityMap = {};
        const municipalityMarkers = {};

        municipalities.forEach(mun => {
            municipalityMap[mun.name] = mun;
        });

        // Generate municipality tiles
        const grid = document.getElementById('municipalities-grid');

        allMunicipalities.forEach(name => {
            const tile = document.createElement('button');
            tile.className = 'municipality-tile';
            tile.textContent = name;

            // Check if this municipality is on the map
            const munData = municipalityMap[name];
            if (munData) {
                tile.classList.add('mapped');
                tile.title = 'Click to view on map';
            }

            // Special styling for Lucerne city
            if (name === 'Lucerne') {
                tile.classList.add('lucerne-city');
            }

            // Add click handler
            tile.addEventListener('click', () => {
                // Remove active class from all tiles
                document.querySelectorAll('.municipality-tile').forEach(t => {
                    if (!t.classList.contains('lucerne-city')) {
                        t.classList.remove('active');
                    }
                });

                if (name === 'Lucerne') {
                    // Navigate to Lucerne city page
                    window.location.href = 'lucerne-city.html';
                    return;
                }

                if (munData) {
                    // Zoom to municipality on map
                    map.setView([munData.lat, munData.lon], 13, {
                        animate: true,
                        duration: 1
                    });

                    // Find and open the marker popup
                    const marker = municipalityMarkers[name];
                    if (marker) {
                        marker.openPopup();
                    }

                    // Mark tile as active
                    tile.classList.add('active');

                    // Update info panel
                    const infoPanel = document.getElementById('municipality-info');
                    infoPanel.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="font-size: 16px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;">${munData.name}</h4>
                                <p style="font-size: 13px; color: #666;">District: ${munData.district}</p>
                            </div>
                            <div style="text-align: right;">
                                <span style="font-size: 11px; color: #999; text-transform: capitalize;">${munData.type}</span>
                            </div>
                        </div>
                    `;

                    // Scroll map into view
                    document.getElementById('canton-map').scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    // Show information for unmapped municipalities
                    const infoPanel = document.getElementById('municipality-info');
                    infoPanel.innerHTML = `
                        <div style="text-align: center;">
                            <h4 style="font-size: 16px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;">${name}</h4>
                            <p style="font-size: 13px; color: #999;">Location details coming soon</p>
                        </div>
                    `;
                }
            });

            grid.appendChild(tile);
        });

        // Store marker references for later use
        municipalities.forEach(municipality => {
            const existingMarkers = map._layers;
            for (let id in existingMarkers) {
                const layer = existingMarkers[id];
                if (layer.getLatLng &&
                    layer.getLatLng().lat === municipality.lat &&
                    layer.getLatLng().lon === municipality.lon) {
                    municipalityMarkers[municipality.name] = layer;
                    break;
                }
            }
        });
    </script>
</body>
</html>
